<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Registration</title>
  <!-- intl-tel-input CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.min.css">

  <style>
    /* Global Styles */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Arial', sans-serif;
    }

    body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #1e3c72, #2a5298);
    }

    .container {
        display: flex;
        max-width: 1100px;
        width: 100%;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        background-color: #fff;
        flex-direction: column;
        padding: 20px;
    }

    /* Left Section */
    .left-section {
        background: linear-gradient(135deg, #1e3c72, #2a5298);
        color: #fff;
        padding: 40px;
        text-align: center;
    }

    .left-section h1 {
        font-size: 40px;
        margin-bottom: 20px;
    }

    .left-section p {
        font-size: 18px;
        margin-bottom: 30px;
        line-height: 1.5;
    }

    .left-section button {
        padding: 12px 20px;
        font-size: 16px;
        font-weight: bold;
        color: #1e3c72;
        background-color: #fff;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .left-section button:hover {
        background-color: #e0e0e0;
    }

    /* Right Section */
    .right-section {
        background-color: #f4f6f9;
        padding: 40px;
        overflow-y: auto;
    }

    .form-container h2 {
        font-size: 28px;
        margin-bottom: 10px;
        color: #1e3c72;
    }

    .form-row {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 15px;
    }

    .form-group {
        flex: 1;
        margin-bottom: 10px;
        min-width: 220px;
    }

    .form-group label {
        display: block;
        font-size: 14px;
        color: #333;
        margin-bottom: 5px;
    }

    .form-group input {
        width: 100%;
        padding: 12px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 8px;
        transition: all 0.3s;
    }

    .form-group input:focus {
        border-color: #1e3c72;
        outline: none;
        box-shadow: 0 0 5px rgba(30, 60, 114, 0.2);
    }

    .otp {
        display: none;
    }

    .form-row button {
        padding: 12px 20px;
        font-size: 16px;
        font-weight: bold;
        background: linear-gradient(135deg, #1e3c72, #2a5298);
        color: #fff;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .form-row button:hover {
        background: linear-gradient(135deg, #153b5b, #1f4578);
    }

    .password-validation {
        font-size: 12px;
        margin-top: 5px;
    }

    .password-validation p {
        margin: 5px 0;
    }

    .invalid {
        color: red;
    }

    .valid {
        color: green;
    }

    /* Mobile Container Adjustments */
    .input-group {
        display: flex;
        align-items: center;
        position: relative;
        width: 100%;
    }

    #mobile {
        padding-left: 40px;
        padding-right: 10px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 8px;
        width: 100%;
        height: 40px;
    }

    .iti__flag-container {
        position: absolute;
        left: 10px;
        top: 50%;
        transform: translateY(-50%);
        z-index: 1;
    }

    .iti__flag {
        width: 20px;
        height: 20px;
        object-fit: contain;
    }

    .iti__country-list {
        max-height: 300px;
        overflow-y: auto;
    }

    @media (max-width: 768px) {
        .container {
            flex-direction: column;
            padding: 20px;
        }

        .left-section, .right-section {
            padding: 15px;
        }

        .form-row {
            flex-direction: column;
        }

        .form-group {
            flex: none;
            width: 100%;
        }

        .password-validation {
            font-size: 10px;
        }
    }
  </style>
</head>

<body>
<div class="container">
  <!-- Left Section -->
  <div class="left-section">
    <h1>Welcome to FuelNest!</h1>
    <p>Your trusted fuel and repair service provider</p>
    <button onclick="window.location.href='Login.html'">Login</button>
    <button style="margin-top: 20px;" onclick="window.history.back()">Back</button>
  </div>

  <!-- Right Section -->
  <div class="right-section">
    <div class="form-container">
      <h2>DeliveryMan Registration</h2>
      <form>
        <div class="form-row">
          <div class="form-group">
            <label for="first-name">First Name <span class="required">*</span></label>
            <input type="text" id="first-name" placeholder="Enter first name" required>
          </div>
          <div class="form-group">
            <label for="last-name">Last Name <span class="required">*</span></label>
            <input type="text" id="last-name" placeholder="Enter last name" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="email">Email Address <span class="required">*</span></label>
            <input type="email" id="email" placeholder="Enter email" required>
            <button id="sendOtpButton" type="button">Send Email OTP</button>
          </div>
          <div class="form-group">
            <label for="mobile">Mobile Number <span class="required">*</span></label>
            <div class="input-group">
              <input type="tel" id="mobile" placeholder="Enter mobile number" required>
            </div>
          </div>
        </div>
        <div class="form-row otp">
          <div class="form-group">
            <label for="otp">OTP <span class="required">*</span></label>
            <input type="text" id="otp" placeholder="Enter OTP">
            <button id="verifyOtpButton" type="button">Verify OTP</button>
          </div>
        </div>
        <div class="form-group">
          <label for="password">Password<span class="required">*</span></label>
          <input type="password" id="password" required>
          <span id="togglePassword" class="eye-icon">üëÅÔ∏è</span>
        </div>
        <div id="password-validation" class="password-validation">
          <p id="lengthCondition" class="invalid">Password must be at least 8 characters long.</p>
          <p id="uppercaseCondition" class="invalid">Password must contain at least one uppercase letter.</p>
          <p id="numberCondition" class="invalid">Password must contain at least one number.</p>
          <p id="specialCharCondition" class="invalid">Password must contain at least one special character (!@#$%^&*).</p>
        </div>

        <div class="form-group">
          <label for="confirm-password">Confirm Password <span class="required">*</span></label>
          <input type="password" id="confirm-password" required>
          <span id="toggleConfirmPassword" class="eye-icon">üëÅÔ∏è</span>
        </div>
        <div class="form-row">
          <button type="submit" id="registerButton">Register</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- intl-tel-input JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>

<script>
  const input = document.querySelector("#mobile");
  const iti = window.intlTelInput(input, {
      utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"
  });

</script>
<script>
  async function sendEmailOtp() {
   try {
       const email = document.getElementById('email').value;
       if (!email) {
           alert("Please enter your email address.");
           return;
       }

       const response = await fetch('http://localhost:8080/api/sendEmailOtp', {
           method: 'POST',
           headers: {
               'Content-Type': 'application/json'
           },
           body: JSON.stringify({ email }),
           credentials: 'include'
       });

       if (response.ok) {
           alert("OTP sent to your email address.");
           document.querySelector(".otp").style.display = "block"; // Show OTP field
           document.getElementById('sendOtpButton').style.display = "none"; // Hide Send OTP button
       } else {
           alert("Failed to send OTP.");
       }
   } catch (error) {
       console.error("Error:", error);
       alert("Error occurred while sending OTP.");
   }
}

async function verifyOTP() {
   const otp = document.getElementById('otp').value;
   const email = document.getElementById('email').value;

   if (!otp) {
       alert("Please enter the OTP.");
       return;
   }

   try {
       const response = await fetch('http://localhost:8080/api/verifyEmailOtp', {
           method: 'POST',
           headers: {
               'Content-Type': 'application/json'
           },
           body: JSON.stringify({ email, otp })
       });

       if (response.ok) {
           const data = await response.json();
           if (data.success) {
               alert("OTP verified successfully!");

               // Lock email and OTP fields
               document.getElementById('email').disabled = true;
               document.getElementById('otp').disabled = true;

               // Hide both buttons
               document.getElementById('sendOtpButton').style.display = "none";
               document.getElementById('verifyOtpButton').style.display = "none";

               // Optionally, show a success message or additional sections
               document.getElementById('registerButton').disabled = false;
           } else {
               alert("OTP verification failed.");
           }
       } else {
           alert("OTP verification failed.");
       }
   } catch (error) {
       console.error("Error during OTP verification:", error);
       alert("Error during OTP verification.");
   }
}

// Event listeners for buttons
document.getElementById('sendOtpButton').addEventListener('click', sendEmailOtp);
document.getElementById('verifyOtpButton').addEventListener('click', verifyOTP);


document.getElementById('password').addEventListener('input', function () {
   const password = this.value;

   // Conditions
   const lengthCondition = password.length >= 8;
   const uppercaseCondition = /[A-Z]/.test(password);
   const numberCondition = /[0-9]/.test(password);
   const specialCharCondition = /[!@#$%^&*]/.test(password);

   // Update the validation elements
   updateValidationStatus('lengthCondition', lengthCondition);
   updateValidationStatus('uppercaseCondition', uppercaseCondition);
   updateValidationStatus('numberCondition', numberCondition);
   updateValidationStatus('specialCharCondition', specialCharCondition);
});

// Function to update validation status
function updateValidationStatus(conditionId, isValid) {
   const conditionElement = document.getElementById(conditionId);
   if (isValid) {
       conditionElement.classList.remove('invalid');
       conditionElement.classList.add('valid');
   } else {
       conditionElement.classList.remove('valid');
       conditionElement.classList.add('invalid');
   }
}



document.getElementById('togglePassword').addEventListener('click', function () {
   const passwordField = document.getElementById('password');
   const type = passwordField.type === 'password' ? 'text' : 'password';
   passwordField.type = type;
   this.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà'; // Toggle between eye and crossed-eye symbols
});

// Toggle Confirm Password visibility
document.getElementById('toggleConfirmPassword').addEventListener('click', function () {
   const confirmPasswordField = document.getElementById('confirm-password');
   const type = confirmPasswordField.type === 'password' ? 'text' : 'password';
   confirmPasswordField.type = type;
   this.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà'; // Toggle between eye and crossed-eye symbols
});


document.getElementById("registerButton").addEventListener("click", function (event) {
   event.preventDefault(); // Prevent the form from submitting

   // Get form data
   const formData = {
       firstname: document.getElementById("first-name").value,
       lastname: document.getElementById("last-name").value,
       email: document.getElementById("email").value,
       phoneNumber: document.getElementById("mobile").value,
       password: document.getElementById("password").value,
       confirmPassword: document.getElementById("confirm-password").value,
       emailOtp: document.getElementById("otp").value,  // Include OTP here
       address_line1: document.getElementById("address").value,
       nationality: document.getElementById("nationality").value,
       state: document.getElementById("state").value,
       district: document.getElementById("district").value,
       city: document.getElementById("city").value,
       pin_code: document.getElementById("pin_code").value
   };

   console.log("Form Data being sent:", formData);
   // Check if required fields are empty
   let errorMessage = "";
   for (let key in formData) {
       if (formData[key] === "") {
           errorMessage += `${key.charAt(0).toUpperCase() + key.slice(1)} is required.\n`;
       }
   }

   if (errorMessage) {
       // Show alert if any required field is empty
       alert(errorMessage);
       return;
   }

   // Log the form data being sent
   console.log("Sending data:", formData);

   // Convert the data to JSON
   const jsonData = JSON.stringify(formData);

   // Send the data via a POST request
   fetch("http://localhost:8080/api/user/register", {
       method: "POST",
       headers: {
           "Content-Type": "application/json"
       },
       body: jsonData
   })
       .then(response => {
           if (!response.ok) {
               throw new Error("Registration failed: " + response.statusText);
           }
           return response.json();
       })
       .then(data => {
           console.log("Server response:", data); // Log server response for debugging
           if (data.success) {
               alert("Registration successful! You can now log in.");
               window.location.href = 'Login.html'; // Redirect to login page
           } else if (data.error && data.error === "Email already exists") {
               alert("Email already exists. Please use a different email.");
           } else {
               alert("An error occurred during registration.");
           }
       })
       .catch(error => {
           console.error("Error during registration:", error);
           alert("Error during registration: " + error.message);
       });
});



function goLogin() {
window.location.href="Login.html";

}

function goBack() {
window.location.href="SignupOption.html";
}
</script>
</body>

</html>
